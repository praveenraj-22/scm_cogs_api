SELECT  'TOTAL' AS BRANCH,'' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (
SELECT ZIP,ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU','KNP','VLR','KBK','NVL','VPM','DHA','SLM','KSN','ERD','HSR','TVL','CMB','TCN','APM','MDU','TRI','TNJ','TPR','BMH', 'WFD', 'KML', 'CLR', 'INR', 'PNR', 'YLK', 'SVR','BSK','RRN','HUB','DWD', 'MCC', 'MYS','RJN','JGN','DNR', 'HMH', 'MDA', 'SNR', 'HIM', 'SBD','MPM','GCB','VMH', 'NEL', 'GUN', 'TPT', 'RAJ','TVM','KTM','AHM','JPR','IND','JWS','APR','ATA','KWA')
GROUP BY
PARENT,
BRANCH
) AS A
UNION ALL


SELECT 'Chennai Branch Total' AS BRANCH,'' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE BRANCH NOT IN ('PDY','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')
UNION ALL

SELECT 'AEHL:' AS BRANCH,'' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','KNP','VLR','KBK','NVL','VPM','DHA','SLM','KSN','ERD','HSR','JPR','MDU')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'

UNION ALL


SELECT 'Chennai Main Hospital' AS BRANCH, BRANCH AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE BRANCH ='CMH'

UNION ALL


SELECT 'Chennai Branches' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH' AND BRANCH NOT IN('CMH')


UNION ALL


SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT PARENT, BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='ANN' THEN 'Anna nagar'
 WHEN UNT.ACCOUNTUNIT='ASN' THEN 'Ashok Nagar'
 WHEN UNT.ACCOUNTUNIT='AVD' THEN 'Avadi'
 WHEN UNT.ACCOUNTUNIT='NLR' THEN 'Nanganallur'
 WHEN UNT.ACCOUNTUNIT='PMB' THEN 'Perambur'
 WHEN UNT.ACCOUNTUNIT='PRR' THEN 'Porur'
 WHEN UNT.ACCOUNTUNIT='TLR' THEN 'Tiruvallur'
 WHEN UNT.ACCOUNTUNIT='TRC' THEN 'Triplicane'
 WHEN UNT.ACCOUNTUNIT='VLC' THEN 'Velachery'
 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='ANN' THEN 'Anna nagar'
 WHEN UNT.ACCOUNTUNIT='ASN' THEN 'Ashok Nagar'
 WHEN UNT.ACCOUNTUNIT='AVD' THEN 'Avadi'
 WHEN UNT.ACCOUNTUNIT='NLR' THEN 'Nanganallur'
 WHEN UNT.ACCOUNTUNIT='PMB' THEN 'Perambur'
 WHEN UNT.ACCOUNTUNIT='PRR' THEN 'Porur'
 WHEN UNT.ACCOUNTUNIT='TLR' THEN 'Tiruvallur'
 WHEN UNT.ACCOUNTUNIT='TRC' THEN 'Triplicane'
 WHEN UNT.ACCOUNTUNIT='VLC' THEN 'Velachery'
 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT
CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='ANN' THEN 'Anna nagar'
 WHEN UNT.ACCOUNTUNIT='ASN' THEN 'Ashok Nagar'
 WHEN UNT.ACCOUNTUNIT='AVD' THEN 'Avadi'
 WHEN UNT.ACCOUNTUNIT='NLR' THEN 'Nanganallur'
 WHEN UNT.ACCOUNTUNIT='PMB' THEN 'Perambur'
 WHEN UNT.ACCOUNTUNIT='PRR' THEN 'Porur'
 WHEN UNT.ACCOUNTUNIT='TLR' THEN 'Tiruvallur'
 WHEN UNT.ACCOUNTUNIT='TRC' THEN 'Triplicane'
 WHEN UNT.ACCOUNTUNIT='VLC' THEN 'Velachery'
 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')
 AND BRANCH NOT IN ('CMH')
AND ROC.DESCRIPTION='AEH'
GROUP BY
PARENT,
BRANCH
)
 AS B

 GROUP BY
PARENT,
BRANCH


UNION ALL


SELECT 'AHCL:' AS BRANCH,'' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH IN ('TBM','ADY','EGM','MGP','NWP','PDY','TVL','TCN','APM','TRI','TNJ','AMN','BMH','WFD','KML','CLR','INR','PNR','YLK','HUB','DWD','MCC','MYS','DNR','HMH','MDA','SNR','HIM','SBD','VMH','NEL','GUN','TPT','RAJ','TVM','KOL','KAS','PUN','AHM','IND','CTK','BHU','TPR','AMB','SVR','BSK','RRN','TVT','MPM','RJN','CMB','JGN','HDP','VSH','JWS','APR','ATA','KWA','KTM','GCB','CMR')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT IN ('AHC','AHI')


UNION ALL


SELECT 'Chennai Branches' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, ZIP,BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AHC' AND BRANCH NOT IN('PDY','VSH','PUN','HDP','CMR','KOL','KAS','CTK','BHU')

UNION ALL
-- ahc chennai branched
SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='TBM' THEN 'Tambaram'
 WHEN UNT.ACCOUNTUNIT='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='EGM' THEN 'Egmore'
 WHEN UNT.ACCOUNTUNIT='MGP' THEN 'Mogappair'
 WHEN UNT.ACCOUNTUNIT='NWP' THEN 'New Washermenpet'
 WHEN UNT.ACCOUNTUNIT='AMB' THEN 'Ambattur'
  WHEN UNT.ACCOUNTUNIT='TVT' THEN 'Thiruvetriyur'
 WHEN UNT.ACCOUNTUNIT='PDY' THEN 'Pondycherry'


 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='TBM' THEN 'Tambaram'
 WHEN UNT.ACCOUNTUNIT='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='EGM' THEN 'Egmore'
 WHEN UNT.ACCOUNTUNIT='MGP' THEN 'Mogappair'
 WHEN UNT.ACCOUNTUNIT='NWP' THEN 'New Washermenpet'
 WHEN UNT.ACCOUNTUNIT='AMB' THEN 'Ambattur'
   WHEN UNT.ACCOUNTUNIT='TVT' THEN 'Thiruvetriyur'
 WHEN UNT.ACCOUNTUNIT='PDY' THEN 'Pondycherry'

 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE
-- WHEN UNT.ACCOUNTUNIT=='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='TBM' THEN 'Tambaram'
 WHEN UNT.ACCOUNTUNIT='ADY' THEN 'Adyar'
 WHEN UNT.ACCOUNTUNIT='EGM' THEN 'Egmore'
 WHEN UNT.ACCOUNTUNIT='MGP' THEN 'Mogappair'
 WHEN UNT.ACCOUNTUNIT='NWP' THEN 'New Washermenpet'
 WHEN UNT.ACCOUNTUNIT='AMB' THEN 'Ambattur'
   WHEN UNT.ACCOUNTUNIT='TVT' THEN 'Thiruvetriyur'
 WHEN UNT.ACCOUNTUNIT='PDY' THEN 'Pondycherry'

 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('CMH','ANN','ASN','AVD','NLR','PMB','PRR','TLR','TRC','VLC','TBM','ADY','EGM','MGP','NWP','PDY','AMB','TVT')
-- AND BRANCH NOT IN ('CMH')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

  GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL







SELECT 'ROTN' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('KNP','VLR','KBK','NVL','VPM','DHA','SLM','KSN','ERD','HSR','TVL','CMB','TCN','APM','MDU','TRI','TNJ','TPR')
GROUP BY
BRANCH
) AS A

UNION ALL


SELECT 'Kanchi + Vellore' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('KNP','VLR')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'

UNION ALL



SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KNP' THEN 'Kanchipuram'
 WHEN UNT.ACCOUNTUNIT='VLR' THEN 'Vellore'

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KNP' THEN 'Kanchipuram'
 WHEN UNT.ACCOUNTUNIT='VLR' THEN 'Vellore'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KNP' THEN 'Kanchipuram'
 WHEN UNT.ACCOUNTUNIT='VLR' THEN 'Vellore'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('KNP','VLR')
AND ROC.DESCRIPTION='AEH'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)




UNION ALL






SELECT 'Kum + Ney + Vil' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('KBK','NVL','VPM')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'


UNION ALL



SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KBK' THEN 'Kumbakonam'
 WHEN UNT.ACCOUNTUNIT='NVL' THEN 'Neyveli'
 WHEN UNT.ACCOUNTUNIT='VPM' THEN 'Villupuram'

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KBK' THEN 'Kumbakonam'
 WHEN UNT.ACCOUNTUNIT='NVL' THEN 'Neyveli'
 WHEN UNT.ACCOUNTUNIT='VPM' THEN 'Villupuram'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KBK' THEN 'Kumbakonam'
 WHEN UNT.ACCOUNTUNIT='NVL' THEN 'Neyveli'
 WHEN UNT.ACCOUNTUNIT='VPM' THEN 'Villupuram'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('KBK','NVL','VPM')
AND ROC.DESCRIPTION='AEH'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL

SELECT 'Dha + Salem + Krish' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('DHA','SLM','KSN')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'


UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='DHA' THEN 'Dharmapuri'
 WHEN UNT.ACCOUNTUNIT='SLM' THEN 'Salem'
 WHEN UNT.ACCOUNTUNIT='KSN' THEN 'Krishnagiri'

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='DHA' THEN 'Dharmapuri'
 WHEN UNT.ACCOUNTUNIT='SLM' THEN 'Salem'
 WHEN UNT.ACCOUNTUNIT='KSN' THEN 'Krishnagiri'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='DHA' THEN 'Dharmapuri'
 WHEN UNT.ACCOUNTUNIT='SLM' THEN 'Salem'
 WHEN UNT.ACCOUNTUNIT='KSN' THEN 'Krishnagiri'


 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('DHA','SLM','KSN')
AND ROC.DESCRIPTION='AEH'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)







UNION ALL

SELECT 'Erode + Hosur' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('ERD','HSR')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='ERD' THEN 'Erode'
 WHEN UNT.ACCOUNTUNIT='HSR' THEN 'Hosur'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='ERD' THEN 'Erode'
 WHEN UNT.ACCOUNTUNIT='HSR' THEN 'Hosur'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='ERD' THEN 'Erode'
 WHEN UNT.ACCOUNTUNIT='HSR' THEN 'Hosur'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('ERD','HSR')
AND ROC.DESCRIPTION='AEH'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL

SELECT 'Tirunelveli' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('TVL')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AHC'




UNION ALL

SELECT 'Coimbatore' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('CMB')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AHC'


UNION ALL

SELECT 'Tuticorin + Madurai' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('TCN','APM','MDU')
GROUP BY
PARENT,
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TCN' THEN 'Tuticorin'
 WHEN UNT.ACCOUNTUNIT='APM' THEN 'Madurai'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TCN' THEN 'Tuticorin'
 WHEN UNT.ACCOUNTUNIT='APM' THEN 'Madurai'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TCN' THEN 'Tuticorin'
 WHEN UNT.ACCOUNTUNIT='APM' THEN 'Madurai'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('TCN','APM')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)

UNION ALL

SELECT 'Madurai KK Nagar' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('MDU')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AEH'




UNION ALL

SELECT 'Trichy + Thanjavur' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('TRI','TNJ')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AHC'



UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TRI' THEN 'Trichy'
 WHEN UNT.ACCOUNTUNIT='TNJ' THEN 'Thanjavur'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TRI' THEN 'Trichy'
 WHEN UNT.ACCOUNTUNIT='TNJ' THEN 'Thanjavur'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TRI' THEN 'Trichy'
 WHEN UNT.ACCOUNTUNIT='TNJ' THEN 'Thanjavur'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('TRI','TNJ')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)




UNION ALL

SELECT 'Tiruppur' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('TPR')
GROUP BY
PARENT,
BRANCH
) AS A
WHERE PARENT ='AHC'

UNION ALL

SELECT 'Karnataka' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('BMH', 'WFD', 'KML', 'CLR', 'INR', 'PNR', 'YLK', 'SVR','BSK','RRN','HUB','DWD', 'MCC', 'MYS','RJN','JGN')
GROUP BY
BRANCH
) AS A


UNION ALL

SELECT 'Banglore' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('BMH', 'WFD', 'KML', 'CLR', 'INR', 'PNR', 'YLK','SVR','BSK','RRN','RJN','JGN')
GROUP BY
BRANCH
) AS A




UNION ALL

SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='BMH' THEN 'Bangalore Main Hospital'
 WHEN UNT.ACCOUNTUNIT='JGN' THEN 'Jigani'
 WHEN UNT.ACCOUNTUNIT='WFD' THEN 'White Field'
 WHEN UNT.ACCOUNTUNIT='KML' THEN 'Koramangala'
 WHEN UNT.ACCOUNTUNIT='CLR' THEN 'Coles Park'
 WHEN UNT.ACCOUNTUNIT='INR' THEN 'Indra Nagar'
 WHEN UNT.ACCOUNTUNIT='PNR' THEN 'Padmanabhanagar'
 WHEN UNT.ACCOUNTUNIT='YLK' THEN 'Yelahanka'
 WHEN UNT.ACCOUNTUNIT='SVR' THEN 'Shivaji Nagar'
 WHEN UNT.ACCOUNTUNIT='BSK' THEN 'Bansankari'
 WHEN UNT.ACCOUNTUNIT='RRN' THEN 'Rajarajeshwari Nagar'
 WHEN UNT.ACCOUNTUNIT='RJN' THEN 'rajaji Nagar'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='BMH' THEN 'Bangalore Main Hospital'
 WHEN UNT.ACCOUNTUNIT='JGN' THEN 'Jigani'
 WHEN UNT.ACCOUNTUNIT='WFD' THEN 'White Field'
 WHEN UNT.ACCOUNTUNIT='KML' THEN 'Koramangala'
 WHEN UNT.ACCOUNTUNIT='CLR' THEN 'Coles Park'
 WHEN UNT.ACCOUNTUNIT='INR' THEN 'Indra Nagar'
 WHEN UNT.ACCOUNTUNIT='PNR' THEN 'Padmanabhanagar'
 WHEN UNT.ACCOUNTUNIT='YLK' THEN 'Yelahanka'
 WHEN UNT.ACCOUNTUNIT='SVR' THEN 'Shivaji Nagar'
 WHEN UNT.ACCOUNTUNIT='BSK' THEN 'Bansankari'
 WHEN UNT.ACCOUNTUNIT='RRN' THEN 'Rajarajeshwari Nagar'
 WHEN UNT.ACCOUNTUNIT='RJN' THEN 'rajaji Nagar'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='BMH' THEN 'Bangalore Main Hospital'
 WHEN UNT.ACCOUNTUNIT='JGN' THEN 'Jigani'
 WHEN UNT.ACCOUNTUNIT='WFD' THEN 'White Field'
 WHEN UNT.ACCOUNTUNIT='KML' THEN 'Koramangala'
 WHEN UNT.ACCOUNTUNIT='CLR' THEN 'Coles Park'
 WHEN UNT.ACCOUNTUNIT='INR' THEN 'Indra Nagar'
 WHEN UNT.ACCOUNTUNIT='PNR' THEN 'Padmanabhanagar'
 WHEN UNT.ACCOUNTUNIT='YLK' THEN 'Yelahanka'
 WHEN UNT.ACCOUNTUNIT='SVR' THEN 'Shivaji Nagar'
 WHEN UNT.ACCOUNTUNIT='BSK' THEN 'Bansankari'
 WHEN UNT.ACCOUNTUNIT='RRN' THEN 'Rajarajeshwari Nagar'
 WHEN UNT.ACCOUNTUNIT='RJN' THEN 'rajaji Nagar'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('BMH', 'WFD', 'KML', 'CLR', 'INR', 'PNR', 'YLK','SVR','BSK','RRN','RJN','JGN')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)



UNION ALL

SELECT 'Hubli + Mysore' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('HUB','DWD', 'MCC', 'MYS')
GROUP BY
BRANCH
) AS A





UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='HUB' THEN 'Hubli'
 WHEN UNT.ACCOUNTUNIT='DWD' THEN 'Dharwad'
 WHEN UNT.ACCOUNTUNIT='MCC' THEN 'Mysore City center'
 WHEN UNT.ACCOUNTUNIT='MYS' THEN 'Mysore'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='HUB' THEN 'Hubli'
 WHEN UNT.ACCOUNTUNIT='DWD' THEN 'Dharwad'
 WHEN UNT.ACCOUNTUNIT='MCC' THEN 'Mysore City center'
 WHEN UNT.ACCOUNTUNIT='MYS' THEN 'Mysore'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='HUB' THEN 'Hubli'
 WHEN UNT.ACCOUNTUNIT='DWD' THEN 'Dharwad'
 WHEN UNT.ACCOUNTUNIT='MCC' THEN 'Mysore City center'
 WHEN UNT.ACCOUNTUNIT='MYS' THEN 'Mysore'




 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('HUB','DWD','MCC', 'MYS')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL



SELECT 'Maharashtra' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('VSH', 'PUN', 'HDP','CMR')
GROUP BY
BRANCH
) AS A





UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VSH' THEN 'Vashi'
 WHEN UNT.ACCOUNTUNIT='PUN' THEN 'Pune'
 WHEN UNT.ACCOUNTUNIT='HDP' THEN 'Hadapsar'
 WHEN UNT.ACCOUNTUNIT='CMR' THEN 'Chembur'
 
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VSH' THEN 'Vashi'
 WHEN UNT.ACCOUNTUNIT='PUN' THEN 'Pune'
 WHEN UNT.ACCOUNTUNIT='HDP' THEN 'Hadapsar'
 WHEN UNT.ACCOUNTUNIT='CMR' THEN 'Chembur'




 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VSH' THEN 'Vashi'
 WHEN UNT.ACCOUNTUNIT='PUN' THEN 'Pune'
 WHEN UNT.ACCOUNTUNIT='HDP' THEN 'Hadapsar'
 WHEN UNT.ACCOUNTUNIT='CMR' THEN 'Chembur'
 




 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('VSH', 'PUN', 'HDP','CMR')
AND ROC.DESCRIPTION IN ('AHC','AHI')
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)








UNION ALL

SELECT 'Telangana' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('DNR', 'HMH', 'MDA', 'SNR', 'HIM', 'SBD','MPM','GCB')
GROUP BY
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='DNR' THEN 'Dilsukh Nagar'
 WHEN UNT.ACCOUNTUNIT='HMH' THEN 'Hyderabad Main Hospital'
 WHEN UNT.ACCOUNTUNIT='MDA' THEN 'Madeenaguda'
 WHEN UNT.ACCOUNTUNIT='SNR' THEN 'Santhosh Nagar'
 WHEN UNT.ACCOUNTUNIT='HIM' THEN 'Himayat Nagar'
 WHEN UNT.ACCOUNTUNIT='SBD' THEN 'Secunderabad'
 WHEN UNT.ACCOUNTUNIT='MPM' THEN 'Mehdipatnam'
 WHEN UNT.ACCOUNTUNIT='GCB' THEN 'Gachibowli'
 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

  WHEN UNT.ACCOUNTUNIT='DNR' THEN 'Dilsukh Nagar'
 WHEN UNT.ACCOUNTUNIT='HMH' THEN 'Hyderabad Main Hospital'
 WHEN UNT.ACCOUNTUNIT='MDA' THEN 'Madeenaguda'
 WHEN UNT.ACCOUNTUNIT='SNR' THEN 'Santhosh Nagar'
 WHEN UNT.ACCOUNTUNIT='HIM' THEN 'Himayat Nagar'
 WHEN UNT.ACCOUNTUNIT='SBD' THEN 'Secunderabad'
 WHEN UNT.ACCOUNTUNIT='MPM' THEN 'Mehdipatnam'
  WHEN UNT.ACCOUNTUNIT='GCB' THEN 'Gachibowli'



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='DNR' THEN 'Dilsukh Nagar'
 WHEN UNT.ACCOUNTUNIT='HMH' THEN 'Hyderabad Main Hospital'
 WHEN UNT.ACCOUNTUNIT='MDA' THEN 'Madeenaguda'
 WHEN UNT.ACCOUNTUNIT='SNR' THEN 'Santhosh Nagar'
 WHEN UNT.ACCOUNTUNIT='HIM' THEN 'Himayat Nagar'
 WHEN UNT.ACCOUNTUNIT='SBD' THEN 'Secunderabad'
 WHEN UNT.ACCOUNTUNIT='MPM' THEN 'Mehdipatnam'
  WHEN UNT.ACCOUNTUNIT='GCB' THEN 'Gachibowli'




 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('DNR', 'HMH', 'MDA', 'SNR', 'HIM', 'SBD','MPM','GCB')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL

SELECT 'Andhra Pradesh' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('VMH', 'NEL', 'GUN', 'TPT', 'RAJ')
GROUP BY
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VMH' THEN 'Vizag Main Hospital'
 WHEN UNT.ACCOUNTUNIT='NEL' THEN 'Nellore'
 WHEN UNT.ACCOUNTUNIT='GUN' THEN 'Guntur'
 WHEN UNT.ACCOUNTUNIT='TPT' THEN 'Tirupathi'
 WHEN UNT.ACCOUNTUNIT='RAJ' THEN 'Rajamundri'

 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VMH' THEN 'Vizag Main Hospital'
 WHEN UNT.ACCOUNTUNIT='NEL' THEN 'Nellore'
 WHEN UNT.ACCOUNTUNIT='GUN' THEN 'Guntur'
 WHEN UNT.ACCOUNTUNIT='TPT' THEN 'Tirupathi'
 WHEN UNT.ACCOUNTUNIT='RAJ' THEN 'Rajamundri'




 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='VMH' THEN 'Vizag Main Hospital'
 WHEN UNT.ACCOUNTUNIT='NEL' THEN 'Nellore'
 WHEN UNT.ACCOUNTUNIT='GUN' THEN 'Guntur'
 WHEN UNT.ACCOUNTUNIT='TPT' THEN 'Tirupathi'
 WHEN UNT.ACCOUNTUNIT='RAJ' THEN 'Rajamundri'
 



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('VMH', 'NEL', 'GUN', 'TPT', 'RAJ')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL

SELECT 'Kerala' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('TVM','KTM')
GROUP BY
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TVM' THEN 'Trivandrum'
 WHEN UNT.ACCOUNTUNIT='KTM' THEN 'Kottayam'


 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TVM' THEN 'Trivandrum'
 WHEN UNT.ACCOUNTUNIT='KTM' THEN 'Kottayam'





 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='TVM' THEN 'Trivandrum'
 WHEN UNT.ACCOUNTUNIT='KTM' THEN 'Kottayam'

 



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('TVM','KTM')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)


UNION ALL

SELECT 'West Bengal - Kolkata' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('KOL', 'KAS')
GROUP BY
BRANCH
) AS A


UNION ALL

SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

WHEN UNT.ACCOUNTUNIT='KOL' THEN 'Peerless'
 WHEN UNT.ACCOUNTUNIT='KAS' THEN 'Kashba'

 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KOL' THEN 'Peerless'
 WHEN UNT.ACCOUNTUNIT='KAS' THEN 'Kashba'





 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='KOL' THEN 'Peerless'
 WHEN UNT.ACCOUNTUNIT='KAS' THEN 'Kashba'

 



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('KOL', 'KAS')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)




UNION ALL



SELECT 'Odisha' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('CTK', 'BHU')
GROUP BY
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='CTK' THEN 'Cuttack'
 WHEN UNT.ACCOUNTUNIT='BHU' THEN 'Bhuvaneswar'

 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='CTK' THEN 'Cuttack'
 WHEN UNT.ACCOUNTUNIT='BHU' THEN 'Bhuvaneswar'





 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='CTK' THEN 'Cuttack'
 WHEN UNT.ACCOUNTUNIT='BHU' THEN 'Bhuvaneswar'

 



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('CTK', 'BHU')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)






UNION ALL

SELECT 'Gujarat - Ahmedabad' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('AHM')
GROUP BY
BRANCH
) AS A


UNION ALL

SELECT 'Jaipur' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('JPR')
GROUP BY
BRANCH
) AS A


UNION ALL

SELECT 'Madhya Pradesh' AS BRANCH, '' AS CODE,COUNT(BRANCH) AS 'COUNT', SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (SELECT ROC.DESCRIPTION AS PARENT, BRANCH,SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
UNION ALL
SELECT
UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)
)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
WHERE BRANCH IN ('IND','JWS','APR','ATA','KWA')
GROUP BY
BRANCH
) AS A




UNION ALL


SELECT * FROM (
(

SELECT PARENT AS BRANCH,BRANCH AS CODE, 1 AS 'COUNT',SUM(FTD) AS FTD,SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD,CONCAT(ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD)*100),0),'%') AS 'MTDPERC'
FROM (


SELECT PARENT, ZIP  ,BRANCH, SUM(FTD) AS FTD, SUM(MTD) AS MTD, SUM(LYMTD) AS LYMTD, ROUND(((SUM(MTD)-SUM(LYMTD))/SUM(LYMTD))*100,2) AS MTDGROW FROM (

SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='IND' THEN 'Indore'
 WHEN UNT.ACCOUNTUNIT='JWS' THEN 'Janjeerwala Square'
 WHEN UNT.ACCOUNTUNIT='APR' THEN 'Annapurna'
 WHEN UNT.ACCOUNTUNIT='ATA' THEN 'Ashta'
 WHEN UNT.ACCOUNTUNIT='KWA' THEN 'Khandwa'


 

 END AS PARENT,
UNT.ACCOUNTUNIT AS BRANCH
-- ,DATE(CRE.`CREATEDTIME`) AS DATE
, COUNT(*) AS FTD
, 0 AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT

-- , DATE(CRE.`CREATEDTIME`)
UNION ALL
SELECT

CASE

 WHEN UNT.ACCOUNTUNIT='IND' THEN 'Indore'
 WHEN UNT.ACCOUNTUNIT='JWS' THEN 'Janjeerwala Square'
 WHEN UNT.ACCOUNTUNIT='APR' THEN 'Annapurna'
 WHEN UNT.ACCOUNTUNIT='ATA' THEN 'Ashta'
 WHEN UNT.ACCOUNTUNIT='KWA' THEN 'Khandwa'





 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- ,MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, COUNT(*) AS MTD
, 0 AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN DATE_SUB(DATE(NOW()),INTERVAL (DAY(NOW())-1) DAY) AND DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)


UNION ALL
SELECT

CASE

WHEN UNT.ACCOUNTUNIT='IND' THEN 'Indore'
 WHEN UNT.ACCOUNTUNIT='JWS' THEN 'Janjeerwala Square'
 WHEN UNT.ACCOUNTUNIT='APR' THEN 'Annapurna'
 WHEN UNT.ACCOUNTUNIT='ATA' THEN 'Ashta'
 WHEN UNT.ACCOUNTUNIT='KWA' THEN 'Khandwa'

 



 END AS PARENT
,UNT.ACCOUNTUNIT AS BRANCH
-- , MONTH(CRE.`CREATEDTIME`) AS DATE
, 0 AS FTD
, 0 AS MTD
, COUNT(*) AS LYMTD
FROM
RT_INDIVIDUAL_PATIENT PAT JOIN RT_INDIVIDUAL_CORE CRE ON CRE.ID=PAT.ID
JOIN `RT_DATA_ACCOUNT_UNIT` UNT ON PAT.ACCUNIT = UNT.ID
WHERE
DATE(CRE.`CREATEDTIME`) BETWEEN  (DATE_ADD(DATE_ADD(DATE_ADD(LAST_DAY(NOW()),INTERVAL 1 DAY),INTERVAL -1 MONTH),INTERVAL -1 YEAR) ) AND (DATE_SUB(DATE_SUB(CURDATE(), INTERVAL 1 DAY), INTERVAL 1 YEAR))
GROUP BY
UNT.ACCOUNTUNIT
-- , MONTH(CRE.`CREATEDTIME`)

)  A JOIN RT_ORGANIZATION_CORE ROC ON ROC.ORGANIZATIONNAME=BRANCH
 WHERE BRANCH  IN ('IND','JWS','APR','ATA','KWA')
AND ROC.DESCRIPTION='AHC'
GROUP BY
PARENT,
BRANCH

)
 AS Bd

GROUP BY
PARENT,
BRANCH
ORDER BY ZIP

)AS a
)